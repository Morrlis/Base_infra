# E2E Testing Base Image

## Что это такое простыми словами?

Это **заготовка для тестирования** веб-приложений. Представь, что это как «коробка с инструментами», которую ты собираешь один раз, а потом используешь во всех своих проектах.

### Аналогия

Когда ты покупаешь новый телефон, он уже с установленной операционной системой, браузером, камерой и т.д. Тебе не нужно каждый раз устанавливать всё это заново — оно уже есть.

Точно так же эта «коробка» уже содержит:
- Браузеры для тестирования (Chrome, Firefox, Safari-подобный)
- Программы для управления этими браузерами
- Всё необходимое окружение

Вместо того чтобы в **каждом проекте** скачивать браузеры заново (долго, занимает место), ты просто говоришь: «Возьми ту самую коробку, которую я уже подготовил».

---

## Зачем это нужно?

### Проблема ДО:
- Каждый проект скачивает свои браузеры → **много времени** (~10 минут)
- Каждый проект хранит свои браузеры → **много места на диске** (~1.5 GB × количество проектов)
- При пересборке проекта браузеры скачиваются заново → **долго**

### Решение ПОСЛЕ:
- Ты собираешь базовый образ **один раз** (~10 минут)
- Все проекты используют этот образ → **быстро** (~2 минуты на проект)
- Браузеры **общие** для всех проектов → **экономия места** (вместо 5 GB будет 2 GB для 3 проектов)

---

## Как это работает?

### Шаг 1: Подготовка (делаешь один раз)

Ты загружаешь эту «коробку» в специальное облачное хранилище (GitHub Container Registry), откуда её смогут скачать все твои проекты.

```bash
# 1. Зайди в эту папку
cd ~/Coding/Base_infra

# 2. Создай версию образа
git tag v1.51.0
git push origin v1.51.0

# 3. Подожди ~10 минут — GitHub автоматически соберёт образ
```

После этого образ будет доступен по адресу:
```
ghcr.io/morli/e2e-base:v1.51.0
```

### Шаг 2: Использование в проекте

В любом проекте (например, Harbor) ты просто добавляешь в начало файла `Dockerfile`:

```dockerfile
# Используй готовую коробку с браузерами
FROM ghcr.io/morli/e2e-base:v1.51.0

# Дальше твой код проекта...
```

Всё! Теперь проект **наследует** все браузеры из базового образа, не скачивая их заново.

---

## Что внутри «коробки»?

- **Python 3.12** — язык программирования для тестов
- **Playwright** — инструмент для управления браузерами
- **3 браузера:**
  - Chromium (как Google Chrome)
  - Firefox
  - WebKit (движок Safari)
- **Системные библиотеки** — всё, что нужно браузерам для работы в Docker
- **Утилиты:** curl, git, vim (для удобной отладки)

---

## Когда обновлять базовый образ?

Обновляй, когда выходит новая версия Playwright (примерно раз в 1-2 месяца):

1. Проверь новую версию на [Playwright Releases](https://github.com/microsoft/playwright-python/releases)
2. Измени версию в `Dockerfile` (строка 17): `v1.51.0` → `v1.52.0`
3. Создай новый тег: `git tag v1.52.0 && git push origin v1.52.0`
4. Подожди автосборку (~10 минут)
5. Обнови версию в проектах: `FROM ghcr.io/morli/e2e-base:v1.52.0`

---

## Преимущества подхода

✅ **Экономия времени:** Сборка проекта 2 минуты вместо 12
✅ **Экономия места:** Браузеры хранятся один раз, не дублируются
✅ **Стабильность:** Все проекты используют одинаковые версии браузеров
✅ **Простота обновлений:** Обновил базовый образ → пересобрал проекты
✅ **Изоляция:** Каждый проект работает в своём контейнере (нет конфликтов)

---

## Структура папки

```
Base_infra/
├── Dockerfile                     ← Рецепт сборки базового образа
├── .github/workflows/
│   └── build-and-push.yml         ← Автоматическая сборка в облаке
├── README.md                      ← Ты сейчас читаешь это (простое описание)
├── TECHNICAL.md                   ← Технические детали для разработчиков
└── .gitignore                     ← Что не загружать в Git
```

---

## Частые вопросы

**Q: Сколько места занимает базовый образ?**
A: ~1.5 GB (это нормально для E2E тестирования с реальными браузерами)

**Q: Нужно ли пересобирать образ после каждого изменения в проекте?**
A: Нет! Базовый образ обновляется только при обновлении Playwright. Твой проект собирается отдельно и использует готовые браузеры из базового образа.

**Q: Можно ли использовать для проектов на других языках (Node.js, Go)?**
A: Да, но нужно будет изменить базовый образ (например, использовать `playwright:nodejs` вместо `playwright:python`).

**Q: Что делать, если GitHub Actions не запускается?**
A: Проверь, что репозиторий `Base_infra` создан на GitHub и у тебя есть права на публикацию пакетов (Settings → Actions → General → Workflow permissions → Read and write).

---

## Полезные ссылки

- [Playwright Documentation](https://playwright.dev/python/)
- [GitHub Container Registry Guide](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry)
- [Docker Multi-stage Builds](https://docs.docker.com/build/building/multi-stage/)

---

**Версия документа:** 1.0.0
**Дата создания:** 2025-12-02
**Автор:** morli (с помощью Claude Code)
